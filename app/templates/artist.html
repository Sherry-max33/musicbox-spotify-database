<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Artist Search Result – Mockup</title>
  <style>
    :root{
      --bg:#0b0b0b;
      --panel:#121212;
      --card:#1c1c1c;
      --text:#eaeaea;
      --muted:#a7a7a7;
      --border:#2b2b2b;
      --accent:#00f5a0;
      --radius:18px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 50% -200px, rgba(0,245,160,.22), transparent 60%),
        radial-gradient(900px 500px at 90% 0px, rgba(0,194,255,.10), transparent 55%),
        var(--bg);
    }
    .wrap{max-width:1120px;margin:0 auto;padding:22px 18px 60px}

    /* Top bar (match your v2 style: Logo + Search only) */
    .topbar{
      display:flex;align-items:center;gap:14px;
      padding:14px 14px;
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:rgba(18,18,18,.78);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
    }
    .logo{
      display:flex;align-items:center;gap:10px;min-width:180px;
      font-weight:800;
    }
    .logo-badge{
      width:34px;height:34px;border-radius:10px;
      background:linear-gradient(135deg,var(--accent),rgba(0,245,160,.25));
      display:grid;place-items:center;color:#000;font-weight:900;
    }
    .slogan{font-size:12px;color:var(--muted);font-family:var(--mono);margin-top:2px;}
    .search{
      flex:1;display:flex;align-items:center;gap:10px;
      background:rgba(255,255,255,.04);
      border:1px solid var(--border);
      border-radius:999px;
      padding:10px 14px;
    }
    .search input{
      width:100%; border:0;outline:0;background:transparent;color:var(--text);
      font-size:14px;
    }
    .search input:-webkit-autofill,
    .search input:-webkit-autofill:focus{
      -webkit-box-shadow:0 0 0px 1000px rgba(255,255,255,.04) inset;
      -webkit-text-fill-color:var(--text);
      caret-color:var(--text);
    }
    .search-wrap-global{position:relative;flex:1;display:flex;}
    .search-wrap-global .search{flex:1;}
    .global-suggest{position:absolute;left:0;right:0;top:100%;margin:4px 0 0;padding:0;background:rgba(28,28,28,.98);border:1px solid var(--border);border-radius:14px;max-height:320px;overflow-y:auto;z-index:20;box-shadow:0 8px 24px rgba(0,0,0,.4);}
    .global-suggest .sect{padding:8px 0 4px;border-bottom:1px solid rgba(255,255,255,.06);}
    .global-suggest .sect:last-child{border-bottom:0;}
    .global-suggest .sect-title{font-size:11px;letter-spacing:1px;color:var(--muted);font-family:var(--mono);padding:4px 18px 6px;}
    .global-suggest a{display:block;padding:8px 18px;color:var(--text);text-decoration:none;font-size:14px;font-weight:800;}
    .global-suggest a:hover{background:rgba(0,245,160,.12);color:var(--accent);}

    /* Back */
    .back{
      margin:16px 2px 12px;
      display:inline-flex;align-items:center;gap:10px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      padding:10px 12px;border-radius:14px;
      color:var(--text);
      cursor:pointer;
      font-weight:850;
      text-decoration:none;
    }
    .back .arrow{
      width:34px;height:34px;border-radius:12px;
      display:grid;place-items:center;
      background:rgba(0,245,160,.10);
      border:1px solid rgba(0,245,160,.35);
      color:var(--accent);
      font-weight:1000;
    }

    /* Hero */
    .hero{
      position:relative;
      border:1px solid var(--border);
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow: var(--shadow);
      background: rgba(18,18,18,.7);
    }
    .hero-bg{
      height:260px;
      position:relative;
      background-size: cover;
      background-position: center;
    }

    /* Back arrow overlay (simple, no text) */
    .back-arrow{
      position:absolute;
      top:16px; left:16px;
      width:46px;height:46px;
      border-radius:16px;
      background:rgba(0,245,160,.12);
      border:1px solid rgba(0,245,160,.45);
      color:var(--accent);
      display:grid;place-items:center;
      font-weight:1000;
      cursor:pointer;
      z-index:5;
      box-shadow: 0 10px 22px rgba(0,0,0,.35);
      user-select:none;
    }

    .hero-bg::before{
      content:"";
      position:absolute;inset:0;
      background:
        linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.78) 72%, rgba(0,0,0,.92)),
        radial-gradient(900px 400px at 40% 20%, rgba(0,245,160,.12), transparent 60%);
    }
    .hero-content{
      position:absolute;left:18px;right:18px;bottom:16px;
      display:flex;align-items:flex-end;justify-content:space-between;gap:16px;
    }
    .artist-name{
      font-size:42px; font-weight:1000; letter-spacing:.4px; line-height:1.05;
      text-shadow: 0 10px 30px rgba(0,0,0,.65);
    }
    .hero-metrics{
      min-width:240px;
      background: transparent;
      border: 0;
      border-radius:0;
      padding:0;
      backdrop-filter: none;
      margin-left:auto;
    }
    .metric-label{
      color:var(--muted);font-family:var(--mono);font-size:12px;
      letter-spacing:1px;
    }
    .bar{
      height:12px;border-radius:999px;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.08);
      overflow:hidden;
      margin-top:8px;
    }
    .bar > div{
      height:100%;
      background: linear-gradient(90deg, var(--accent), rgba(0,245,160,.45));
      width:0%;
    }
    .metric-value{
      margin-top:8px;
      display:flex;align-items:center;justify-content:space-between;
      font-family:var(--mono);
      color:var(--muted);
      font-size:12px;
    }

    /* Sections */
    .section{
      margin-top:16px;
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:rgba(18,18,18,.72);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .section-head{
      padding:16px 18px;
      border-bottom:1px solid rgba(255,255,255,.06);
      display:flex;align-items:center;justify-content:space-between;
    }
    .section-head .title{
      font-weight:1000;
      letter-spacing:1px;
      font-size:18px;
    }
    .section-head .hint{
      font-family:var(--mono);
      color:var(--muted);
      font-size:12px;
    }

    /* Top tracks table */
    .table{
      width:100%;
      border-collapse:separate;
      border-spacing:0 10px;
      padding: 0 18px 18px;
    }
    thead th{
      text-align:left;
      font-size:12px;
      letter-spacing:.8px;
      color:var(--muted);
      font-family:var(--mono);
      padding:8px 10px 4px;
    }
    .row{
      background:rgba(255,255,255,.03);
      border:1px solid var(--border);
      border-radius:14px;
      overflow:hidden;
    }
    .row td{padding:10px;vertical-align:middle;}
    .rank{
      width:56px;
      font-family:var(--mono);
      color:var(--accent);
      font-weight:900;
      font-size:16px;
    }
    .cover{
      width:54px;height:54px;border-radius:14px;
      overflow:hidden;border:1px solid rgba(255,255,255,.08);
    }
    .cover img{width:100%;height:100%;object-fit:cover;display:block}
    .main{font-weight:900;line-height:1.15;}
    .sub{color:var(--muted);font-size:13px;margin-top:2px;}
    .popcell{min-width:190px;}
    .popwrap{display:flex;align-items:center;gap:10px;}
    .popbar{flex:1;height:10px;border-radius:999px;background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.08);overflow:hidden}
    .popbar > div{height:100%;background:linear-gradient(90deg,var(--accent),rgba(0,245,160,.35));width:0%}
    .popnum{font-family:var(--mono);color:var(--muted);font-size:12px;min-width:26px;text-align:right}
    .play{
      display:inline-flex;align-items:center;justify-content:center;
      width:40px;height:40px;border-radius:12px;
      border:1px solid rgba(0,245,160,.4);
      background:rgba(0,245,160,.10);
      cursor:pointer;
      font-weight:1000;
      color:var(--accent);
    }

    /* Albums grid */
    .grid{
      padding: 0 18px 18px;
      display:grid;
      grid-template-columns: repeat(5, minmax(0,1fr));
      gap:14px;
    }
    .card{
      background:rgba(18,18,18,.65);
      border:1px solid var(--border);
      border-radius:18px;
      overflow:hidden;
      box-shadow: 0 10px 22px rgba(0,0,0,.22);
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease;
      min-height: 240px;
      display:block;
      color:inherit;
      text-decoration:none;
    }
    .card:hover{transform: translateY(-2px); border-color: rgba(0,245,160,.45);}
    .card .img{height:160px; position:relative;background:rgba(255,255,255,.04);}
    .card img{width:100%;height:100%;object-fit:cover;display:block}
    .card .meta{padding:12px}
    .card .meta .t{font-weight:1000}
    .card .meta .a{color:var(--muted); margin-top:6px; font-size:13px}

    /* See more: same colors as back button, rectangular */
    .albums-seemore-btn{
      background:rgba(0,245,160,.12);
      border:1px solid rgba(0,245,160,.45);
      color:var(--accent);
      font-weight:800;
      padding:12px 28px;
      border-radius:12px;
      cursor:pointer;
    }
    .albums-seemore-btn:hover{
      border-color:rgba(0,245,160,.7);
      background:rgba(0,245,160,.18);
    }

    @media (max-width: 980px){
      .grid{grid-template-columns: repeat(3, minmax(0, 1fr));}
      .hero-content{flex-direction:column;align-items:flex-start}
      .hero-metrics{min-width:unset;width:100%}
    }
    @media (max-width: 680px){
      .grid{grid-template-columns: repeat(2, minmax(0, 1fr));}
      .artist-name{font-size:34px}
      .popcell{min-width:150px}
      .section--tracks{
        overflow-x:auto;
        -webkit-overflow-scrolling:touch;
      }
      .section--tracks .table{
        min-width:580px;
        display:table;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Top bar -->
    <div class="topbar">
      <div class="logo">
        <div class="logo-badge">♪</div>
        <div>
          <div style="font-size:14px;line-height:1">MusicBox</div>
          <div class="slogan">Discover your sound.</div>
        </div>
      </div>
      <div class="search-wrap-global">
        <form class="search" method="get" action="{{ url_for('search') }}" title="Search songs, artists, albums" autocomplete="off">
          <span style="color:var(--muted);font-family:var(--mono)">⌕</span>
          <input id="searchInput" name="q" placeholder="Search songs, artists, albums..." autocomplete="off" spellcheck="false" />
        </form>
        <div id="globalSearchSuggest" class="global-suggest" style="display:none;"></div>
      </div>
    </div>
<!-- HERO -->
    <div class="hero">
      <div class="back-arrow" id="backBtn">←</div>
      <div class="hero-bg" id="heroBg"{% if hero_cover %} style="background-image:url('{{ hero_cover }}');{% if hero_focus %} background-position:{{ hero_focus }};{% endif %}"{% endif %}>
        <div class="hero-content">
          <div>
            <div class="artist-name" id="artistName">{{ artist_name or 'Artist' }}</div>
          </div>
          <div class="hero-metrics">
            {% if rank is not none and total_popularity is not none %}
            <div class="metric-value" style="font-size:28px;font-weight:900;color:var(--accent);font-family:var(--mono);"># {{ rank }}</div>
            <div class="metric-label" style="margin-top:6px;">Popularity {{ total_popularity or 0 }}</div>
            {% else %}
            <div class="metric-label">POPULARITY</div>
            <div class="metric-value" style="margin-top:8px;justify-content:flex-start;">
              <span id="artistPopText">—</span>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- TOP TRACKS -->
    <div class="section section--tracks">
      <div class="section-head">
        <div class="title">TOP TRACKS</div>
</div>

      <table class="table">
        <thead>
          <tr>
            <th style="width:56px">RANK</th>
            <th style="width:70px">COVER</th>
            <th>TRACK</th>
            <th style="min-width:160px">ALBUM</th>
            <th class="popcell">POPULARITY</th>
            <th style="width:92px">PREVIEW</th>
          </tr>
        </thead>
        <tbody id="tracksBody">
          {% if tracks %}
          {% for t in tracks %}
          <tr class="row">
            <td class="rank">#{{ loop.index }}</td>
            <td>
              <div class="cover"><img src="{{ t.album_image_url or '' }}" alt="{{ t.track_name }}" loading="lazy" onerror="this.style.display='none';"/></div>
            </td>
            <td>
              <div class="main"><a href="{{ url_for('track') }}?track_id={{ t.track_id }}" style="color:inherit;text-decoration:none;">{{ t.track_name }}</a></div>
              <div class="sub">{{ artist_name }}</div>
            </td>
            <td>
              <div class="sub" style="font-size:14px;color:var(--text);font-weight:850">
                {% if t.album_id %}
                <a href="{{ url_for('album') }}?album_id={{ t.album_id }}" style="color:inherit;text-decoration:none;">{{ t.album_name or '—' }}</a>
                {% else %}
                {{ t.album_name or '—' }}
                {% endif %}
              </div>
            </td>
            <td class="popcell">
              <div class="popwrap">
                <div class="popbar"><div style="width:{{ (t.popularity or 0) }}%"></div></div>
                <div class="popnum">{{ t.popularity or 0 }}</div>
              </div>
            </td>
            <td>
              {% if t.preview_url %}
              <button type="button" class="play preview-play" data-src="{{ t.preview_url }}" aria-label="Preview">▶</button>
              {% else %}
              <span class="sub">—</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
          {% endif %}
        </tbody>
      </table>
    </div>

    <!-- ALBUMS -->
    <div class="section">
      <div class="section-head">
        <div class="title">ALBUMS</div>
      </div>
      <div class="grid" id="albumsGrid">
        {% if albums %}
        {% for a in albums %}
        <a href="{{ url_for('album') }}?album_id={{ a.album_id }}" class="card {% if loop.index > 10 %}album-card-more{% endif %}" {% if loop.index > 10 %}style="display:none"{% endif %}>
          <div class="img"><img src="{{ a.album_image_url or '' }}" alt="{{ a.album_name }}" loading="lazy" onerror="this.style.display='none';"/></div>
          <div class="meta">
            <div class="t">{{ a.album_name }}</div>
            <div class="a">{{ a.release_date or '—' }}</div>
          </div>
        </a>
        {% endfor %}
        {% endif %}
      </div>
      {% if albums and albums|length > 10 %}
      <div class="albums-seemore" style="text-align:center;padding:14px 0;">
        <button type="button" class="btn albums-seemore-btn" id="albumsSeeMoreBtn">See more</button>
      </div>
      {% endif %}
    </div>
  </div>
  <audio id="previewAudio" preload="none" style="display:none"></audio>

<script>
var HAS_ARTIST_DATA = {{ 'true' if (artist_name and (tracks or [])) else 'false' }};
const $ = (s)=>document.querySelector(s);
const $$ = (s)=>Array.from(document.querySelectorAll(s));

// Preview playback (same as viewer)
var previewAudio = document.getElementById("previewAudio");
if (previewAudio) {
  function setAllPlayIcons() { $$(".preview-play").forEach(function(btn){ btn.textContent = "▶"; }); }
  previewAudio.addEventListener("pause", setAllPlayIcons);
  previewAudio.addEventListener("ended", setAllPlayIcons);
  document.addEventListener("click", function(e) {
    var btn = e.target.closest(".preview-play");
    if (!btn || !btn.dataset.src) return;
    var src = btn.dataset.src;
    if (previewAudio.src !== src || previewAudio.paused) {
      setAllPlayIcons();
      previewAudio.src = src;
      previewAudio.play();
      btn.textContent = "❚❚";
    } else {
      previewAudio.pause();
      btn.textContent = "▶";
    }
  });
}

$("#backBtn").addEventListener("click", function(){
  if (history.length > 1) history.back();
  else window.location.href = "{{ url_for('viewer') }}";
});

var albumsSeeMoreBtn = document.getElementById("albumsSeeMoreBtn");
if (albumsSeeMoreBtn) {
  albumsSeeMoreBtn.addEventListener("click", function(){
    $$(".album-card-more").forEach(function(el){ el.style.display = ""; });
    this.style.display = "none";
  });
}

(function(){
  var apiUrl = "{{ url_for('search_api') }}";
  var artistBase = "{{ url_for('artist') }}";
  var albumBase = "{{ url_for('album') }}";
  var trackBase = "{{ url_for('track') }}";
  var input = document.getElementById("searchInput");
  var dropdown = document.getElementById("globalSearchSuggest");
  var wrap = input && input.closest(".search-wrap-global");
  if (!input || !dropdown || !wrap) return;
  function debounce(fn, ms){ var t; return function(){ clearTimeout(t); t = setTimeout(fn, ms); }; }
  function esc(s){ return (s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;"); }
  function showSuggest(data){
    var artists = (data && data.artists) || [];
    var albums = (data && data.albums) || [];
    var tracks = (data && data.tracks) || [];
    var html = "";
    if (artists.length) { html += "<div class=\"sect\"><div class=\"sect-title\">ARTISTS</div>"; artists.forEach(function(o){ html += "<a href=\"" + artistBase + "?artist_id=" + esc(o.id) + "\">" + esc(o.name) + "</a>"; }); html += "</div>"; }
    if (albums.length) { html += "<div class=\"sect\"><div class=\"sect-title\">ALBUMS</div>"; albums.forEach(function(o){ html += "<a href=\"" + albumBase + "?album_id=" + esc(o.id) + "\">" + esc(o.name) + "</a>"; }); html += "</div>"; }
    if (tracks.length) { html += "<div class=\"sect\"><div class=\"sect-title\">TRACKS</div>"; tracks.forEach(function(o){ html += "<a href=\"" + trackBase + "?track_id=" + esc(o.id) + "\">" + esc(o.name) + "</a>"; }); html += "</div>"; }
    if (!html) html = "<div class=\"sect\"><div class=\"sect-title\" style=\"color:var(--muted)\">No results</div></div>";
    dropdown.innerHTML = html;
    dropdown.style.display = "block";
  }
  input.addEventListener("input", debounce(function(){ var q = input.value.trim(); if (!q){ dropdown.style.display = "none"; return; } fetch(apiUrl + "?q=" + encodeURIComponent(q)).then(function(r){ return r.json(); }).then(showSuggest).catch(function(){ showSuggest([]); }); }, 200));
  input.addEventListener("focus", function(){ if (dropdown.innerHTML) dropdown.style.display = "block"; });
  dropdown.addEventListener("click", function(e){ var a = e.target.closest("a[href]"); if (a){ e.preventDefault(); window.location.href = a.getAttribute("href"); } });
  document.addEventListener("click", function(e){ if (!e.target.closest(".search-wrap-global")) dropdown.style.display = "none"; });
})();

if (!HAS_ARTIST_DATA) {
  var ADELE_21_COVER = "https://archive.org/download/mbid-57440dfc-191c-32bd-ada0-14ac366c2a12/mbid-57440dfc-191c-32bd-ada0-14ac366c2a12-835722588_thumb500.jpg";
  var artist = {
    name: "Adele",
    heroCover: ADELE_21_COVER,
    topTracks: [
      {rank:1, cover:ADELE_21_COVER, track:"Rolling in the Deep", album:"21", popularity:98},
      {rank:2, cover:ADELE_21_COVER, track:"Someone Like You", album:"21", popularity:94},
      {rank:3, cover:ADELE_21_COVER, track:"Set Fire to the Rain", album:"21", popularity:90},
    ],
    albums: [{title:"21", year:"2011", cover:ADELE_21_COVER}, {title:"25", year:"2015", cover:ADELE_21_COVER}]
  };
  $("#artistName").textContent = artist.name;
  if ($("#heroBg")) $("#heroBg").style.backgroundImage = "url('" + artist.heroCover + "')";
  var popEl = $("#artistPopText");
  if (popEl) popEl.textContent = "— (mock when no artist_id)";
  $("#tracksBody").innerHTML = artist.topTracks.map(t => `
    <tr class="row"><td class="rank">#${t.rank}</td><td><div class="cover"><img src="${t.cover}" alt="" loading="lazy"/></div></td>
    <td><div class="main">${t.track}</div><div class="sub">${artist.name}</div></td>
    <td><div class="sub" style="font-size:14px;color:var(--text);font-weight:850">${t.album}</div></td>
    <td class="popcell"><div class="popwrap"><div class="popbar"><div style="width:${t.popularity}%"></div></div><div class="popnum">${t.popularity}</div></div></td>
    <td><span class="sub">—</span></td></tr>`).join("");
  $("#albumsGrid").innerHTML = artist.albums.map(a => `
    <div class="card"><div class="img"><img src="${a.cover}" alt="" loading="lazy"/></div><div class="meta"><div class="t">${a.title}</div><div class="a">${a.year}</div></div></div>`).join("");
}
</script>
</body>
</html>
