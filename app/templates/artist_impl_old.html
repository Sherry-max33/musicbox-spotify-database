{% extends "base.html" %}
{% block title %}MusicBox · Artist{% endblock %}

{% block content %}
  <div class="section">

    <!-- ===== TOP BANNER: most representative albums (mock-style) ===== -->
    {% if banner_albums and banner_albums|length > 0 %}
      <div class="card" style="padding:0; overflow:hidden; border-radius:22px;">
        <div style="position:relative; height:180px; display:flex; width:100%;">
          {% for a in banner_albums %}
            {# a: (album_id, album_name, album_image_url, album_popularity) #}
            <div style="flex:1; min-width:0; position:relative;">
              <img src="{{ a[2] }}"
                   alt="{{ a[1] }}"
                   style="width:100%; height:180px; object-fit:cover; display:block; filter:saturate(1.05) contrast(1.05);">
              <div style="position:absolute; inset:0; background: linear-gradient(180deg, rgba(0,0,0,.00), rgba(0,0,0,.35));"></div>
            </div>
          {% endfor %}

          <!-- banner title overlay -->
          <div style="position:absolute; left:16px; right:16px; bottom:14px; display:flex; justify-content:space-between; align-items:flex-end; gap:12px;">
            <div>
              <div style="font-size:12px; letter-spacing:.14em; color:rgba(234,234,234,.75); text-transform:uppercase;">
                Featured Albums
              </div>
              <div style="font-size:22px; font-weight:900; line-height:1.1; margin-top:4px;">
                {{ artist[1] if artist else "Artist" }}
              </div>
              <div class="muted" style="margin-top:4px; font-size:12px;">
                Top albums ranked by summed track popularity
              </div>
            </div>

            <div style="text-align:right;">
              <div class="muted" style="letter-spacing:.12em; text-transform:uppercase; font-size:11px;">
                Total Popularity
              </div>
              <div style="font-size:24px; font-weight:900; color:var(--accent); font-family:var(--mono);">
                {{ artist[2] if artist and artist[2] is not none else "—" }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="spacer" style="height:14px;"></div>
    {% endif %}

    <!-- ===== Artist Header (below banner) ===== -->
    <div class="card" style="padding:18px;">
      <div style="display:flex; gap:16px; align-items:center; flex-wrap:wrap;">
        <div class="cover" style="width:92px; height:92px; border-radius:22px;">
            {# Use first banner album cover as artist avatar; empty if none #}
          {% if banner_albums and banner_albums|length > 0 and banner_albums[0][2] %}
            <img src="{{ banner_albums[0][2] }}" alt="artist cover">
          {% endif %}
        </div>

        <div style="flex:1; min-width:260px;">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
            <div>
              <div style="font-size:28px; font-weight:900; line-height:1.05;">
                {{ artist[1] if artist else "Artist" }}
              </div>
              <div class="muted" style="margin-top:6px;">
                Artist ID: <span style="font-family:var(--mono);">{{ artist[0] if artist else "" }}</span>
              </div>
            </div>

            <div style="text-align:right;">
              <div class="muted" style="letter-spacing:.12em; text-transform:uppercase; font-size:11px;">Total Popularity</div>
              <div style="font-size:26px; font-weight:900; color:var(--accent); font-family:var(--mono);">
                {{ artist[2] if artist and artist[2] is not none else "—" }}
              </div>
            </div>
          </div>

          {% if artist_genres and artist_genres|length > 0 %}
            <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
              {% for g in artist_genres[:10] %}
                <span class="pill" style="padding:8px 10px; border-radius:999px;">{{ g }}</span>
              {% endfor %}
            </div>
          {% endif %}
        </div>

        <div style="display:flex; gap:10px; align-items:center;">
          <a class="btn" href="{{ url_for('viewer') }}">← Back to Viewer</a>
          <a class="btn primary" href="{{ url_for('analyst', genre=focus_genre or '') }}">Go to Analyst</a>
        </div>
      </div>
    </div>

    <div class="spacer" style="height:14px;"></div>

    <!-- ===== Top Tracks + Albums ===== -->
    <div style="display:grid; grid-template-columns: 1.6fr 1fr; gap:14px; margin-top:14px;">

      <!-- Top Tracks -->
      <div class="card" style="padding:12px;">
        <div style="display:flex; align-items:center; justify-content:space-between; padding:6px 6px 10px;">
          <div class="section-title" style="margin:0;">Top Tracks</div>
          <div class="muted" style="font-size:12px;">Sorted by popularity</div>
        </div>

        <div style="overflow:auto;">
          <table class="table">
            <thead>
              <tr>
                <th style="width:70px;">Rank</th>
                <th style="width:70px;">Cover</th>
                <th>Track</th>
                <th style="width:120px;">Popularity</th>
                <th style="width:110px;">Preview</th>
              </tr>
            </thead>
            <tbody>
              {% if top_tracks and top_tracks|length > 0 %}
                {% for t in top_tracks %}
                  {# t: (track_id, track_name, popularity, preview_url, album_name, album_image_url) #}
                  <tr>
                    <td class="rank">#{{ loop.index }}</td>
                    <td>
                      <div class="cover">
                        {% if t[5] %}<img src="{{ t[5] }}" alt="album cover">{% endif %}
                      </div>
                    </td>
                    <td>
                      <div style="font-weight:800;">{{ t[1] }}</div>
                      <div class="muted" style="font-size:12px;">{{ t[4] or "" }}</div>
                    </td>
                    <td class="muted" style="font-family:var(--mono);">
                      {{ t[2] if t[2] is not none else "—" }}
                    </td>
                    <td>
                      {% if t[3] %}
                        <audio controls preload="none" style="width:100px; height:26px;">
                          <source src="{{ t[3] }}" type="audio/mpeg">
                        </audio>
                      {% else %}
                        <span class="muted">—</span>
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr><td colspan="5" class="muted" style="padding:18px;">No tracks found for this artist.</td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Albums -->
      <div class="card" style="padding:12px;">
        <div style="display:flex; align-items:center; justify-content:space-between; padding:6px 6px 10px;">
          <div class="section-title" style="margin:0;">Albums</div>
          <div class="muted" style="font-size:12px;">{{ albums|length if albums else 0 }} total</div>
        </div>

        {% if albums and albums|length > 0 %}
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            {% for a in albums %}
              {# a: (album_id, album_name, album_image_url, release_year, album_popularity) #}
              <div class="card" style="padding:10px; border-radius:18px; background: rgba(16,16,16,.55);">
                <div style="display:flex; gap:10px;">
                  <div class="cover" style="width:54px; height:54px; border-radius:16px;">
                    {% if a[2] %}<img src="{{ a[2] }}" alt="album cover">{% endif %}
                  </div>
                  <div style="min-width:0;">
                    <div style="font-weight:800; font-size:13px; line-height:1.2; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                      {{ a[1] }}
                    </div>
                    <div class="muted" style="font-size:12px; margin-top:4px;">
                      {{ a[3] if a[3] else "—" }}
                      · popularity: <span style="font-family:var(--mono);">{{ a[4] if a[4] is not none else "—" }}</span>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="muted" style="padding:14px;">No albums found.</div>
        {% endif %}
      </div>

    </div>
  </div>
{% endblock %}
